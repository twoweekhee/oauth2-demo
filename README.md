## üîê OAuth2 Demo Project
This project is an OAuth2 social login demo application built with Spring Boot. It supports Google, Kakao, and Naver social login with JWT-based authentication system.

### üöÄ Key Features
- üîë Social Login (Google, Kakao, Naver)
- üé´ JWT-based Authentication (Access Token, Refresh Token)
- üîí Security Configuration (CORS, CSRF)
- üç™ Cookie-based Token Management
- üìù User Terms Agreement Process

### üõ† Tech Stack
Java 21
Spring Boot 3.4.5
Spring Security
Spring OAuth2 Client
JWT (jjwt 0.12.3)
MySQL
Redis
QueryDSL
Lombok

## üîê OAuth2 & Security Implementation Details

### OAuth2 Implementation
1. Social Login Configuration
Configure each social login provider (Google, Kakao, Naver) using Spring Security OAuth2 Client
Set required scope and user-info-uri for each provider
Handle social login user information through CustomOAuth2UserService
2. Authentication Process
Handle OAuth2 authentication requests through CustomAuthorizationRequestResolver
Issue JWT tokens on authentication success via OAuth2AuthenticationSuccessHandler
Handle authentication failures through OAuth2AuthenticationFailureHandler
3. Token Management
Implement JWT-based Access Token and Refresh Token
Store and manage Refresh Tokens using Redis
Secure token transmission through HttpOnly cookies

### Security Implementation
1. Security Configuration
```
@Configuration
public class SecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) {
        return http
            .cors(cors -> cors.configurationSource(corsConfigurationSource()))
            .csrf(AbstractHttpConfigurer::disable)
            .formLogin(AbstractHttpConfigurer::disable)
            .sessionManagement(session -> 
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(authorize -> authorize
                .requestMatchers("/public/**").permitAll()
                .requestMatchers("/private/**").authenticated()
                .anyRequest().denyAll())
            .oauth2Login(oauth2 -> oauth2
                .authorizationEndpoint(endpoint -> endpoint
                    .authorizationRequestResolver(customAuthorizationRequestResolver))
                .userInfoEndpoint(userInfo -> userInfo
                    .userService(customOAuth2UserService))
                .successHandler(oAuth2AuthenticationSuccessHandler)
                .failureHandler(oAuth2AuthenticationFailureHandler))
            .build();
    }
}
```
2. Authentication Filters
LoginAuthFilter: JWT token validation and authentication handling
LogoutAuthFilter: Logout processing and token removal
3. CORS Configuration
```
@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration configuration = new CorsConfiguration();
    configuration.setAllowedOrigins(Arrays.asList("*"));
    configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"));
    configuration.setAllowedHeaders(Arrays.asList("*"));
    configuration.setAllowCredentials(true);
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/api/**", configuration);
    return source;
}
```
4. Security Enhancements
Stateless session management for reduced server load
CSRF protection disabled (REST API based)
XSS attack prevention through HttpOnly cookies
Enhanced security through Redis-based token management

## ‚öôÔ∏è Environment Configuration
Required Environment Variables
properties
### OAuth2 Client Credentials
```
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
KAKAO_CLIENT_ID=your_kakao_client_id
KAKAO_CLIENT_SECRET=your_kakao_client_secret
NAVER_CLIENT_ID=your_naver_client_id
NAVER_CLIENT_SECRET=your_naver_client_secret
```
### JWT Keys
```
ACCESS_TOKEN_KEY=your_access_token_key
REFRESH_TOKEN_KEY=your_refresh_token_key
```
### Database
```
MYSQL_URL=jdbc:mysql://localhost:3306/oauth2_demo
MYSQL_USER_NAME=your_mysql_username
MYSQL_PASSWORD=your_mysql_password
```
## üèó Project Structure
```
src/main/java/com/example/oauth2demo/
‚îú‚îÄ‚îÄ auth/                 # Authentication related code
‚îÇ   ‚îú‚îÄ‚îÄ application/     # Authentication service logic
‚îÇ   ‚îú‚îÄ‚îÄ domain/         # Domain models
‚îÇ   ‚îú‚îÄ‚îÄ dto/            # Data transfer objects
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/ # Infrastructure related code
‚îú‚îÄ‚îÄ common/             # Common configuration and utilities
‚îú‚îÄ‚îÄ terms/             # Terms related code
‚îî‚îÄ‚îÄ user/              # User related code
```

## üîÑ Authentication Process
1. Social Login Process
Client requests social login (/api/public/oauth2/{provider})
Redirect to OAuth2 authentication page
User authenticates with social login provider
Redirect to callback URL on successful authentication
Server obtains and processes user information
Issue JWT tokens and store in cookies
Redirect to main page
2. User Registration Process
Check for new user after successful social login
Redirect to terms agreement page for new users
Save user information:
Social account information (email, social ID, provider)
User role (ROLE_USER)
Save terms agreement information
Redirect to main page after registration completion
3. Logout Process
- Client requests logout (/api/public/logout)
- LogoutAuthFilter processes the request
- Delete Refresh Token from Redis
- Delete Access Token and Refresh Token cookies:
```
Cookie deletedAccessCookie = cookieProvider.generateDeletedAccessTokenCookie();
Cookie deletedRefreshCookie = cookieProvider.generateDeletedRefreshTokenCookie();
response.addCookie(deletedAccessCookie);
response.addCookie(deletedRefreshCookie);
```
- Clear SecurityContext
- Redirect to login page

4. Token Refresh Process
When Access Token expires (30 minutes)
Request new Access Token with Refresh Token
Validate Refresh Token in Redis
Issue new Access Token if valid
Store new Access Token in cookie
Maintain existing Refresh Token (2 days)

## üîí Security Settings
CORS Configuration: Allow cross-origin requests for API endpoints
CSRF Protection: Disabled for REST API based architecture
Session Management: Uses stateless approach
Token Management: Uses HttpOnly cookies

## üß™ Testing
```
./gradlew test
```

### üöÄ How to Run
Set environment variables
Start MySQL and Redis servers
Run the application:
```
./gradlew bootRun
```
### üìù API Documentation
Swagger UI: http://localhost:8080/api/swagger-ui/index.html
OpenAPI Documentation: http://localhost:8080/api/api-docs

### üîë Token Expiration Times
Access Token: 30 minutes
Refresh Token: 2 days

### üìã Prerequisites
Java 21 or higher
MySQL 8.0 or higher
Redis 6.0 or higher
Gradle 7.0 or higher

### ü§ù Contributing
Fork the repository
Create your feature branch (git checkout -b feature/AmazingFeature)
Commit your changes (git commit -m 'Add some AmazingFeature')
Push to the branch (git push origin feature/AmazingFeature)
Open a Pull Request

### üìÑ License
This project is licensed under the MIT License - see the LICENSE file for details.

### üìû Contact
Author: Your Name
Email: your.email@example.com
Project Link: https://github.com/yourusername/oauth2-demo

---

# üîê OAuth2 Demo Project

Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Îäî Spring BootÎ•º ÏÇ¨Ïö©Ìïú OAuth2 ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Îç∞Î™® Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏûÖÎãàÎã§. Google, Kakao, Naver ÏÜåÏÖú Î°úÍ∑∏Ïù∏ÏùÑ ÏßÄÏõêÌïòÎ©∞, JWT Í∏∞Î∞òÏùò Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏùÑ Íµ¨ÌòÑÌñàÏäµÎãàÎã§.

## üöÄ Ï£ºÏöî Í∏∞Îä•

- üîë ÏÜåÏÖú Î°úÍ∑∏Ïù∏ (Google, Kakao, Naver)
- üé´ JWT Í∏∞Î∞ò Ïù∏Ï¶ù (Access Token, Refresh Token)
- üîí Î≥¥Ïïà ÏÑ§Ï†ï (CORS, CSRF)
- üç™ Ïø†ÌÇ§ Í∏∞Î∞ò ÌÜ†ÌÅ∞ Í¥ÄÎ¶¨
- üìù ÏÇ¨Ïö©Ïûê ÏïΩÍ¥Ä ÎèôÏùò ÌîÑÎ°úÏÑ∏Ïä§

## üõ† Í∏∞Ïà† Ïä§ÌÉù

- Java 21
- Spring Boot 3.4.5
- Spring Security
- Spring OAuth2 Client
- JWT (jjwt 0.12.3)
- MySQL
- Redis
- QueryDSL
- Lombok

## üîê OAuth2 & Security Íµ¨ÌòÑ ÏÉÅÏÑ∏

### OAuth2 Íµ¨ÌòÑ Î∞©Ïãù

1. **ÏÜåÏÖú Î°úÍ∑∏Ïù∏ ÏÑ§Ï†ï**
   - Spring Security OAuth2 ClientÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Í∞Å ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Ï†úÍ≥µÏûê(Google, Kakao, Naver) ÏÑ§Ï†ï
   - Í∞Å Ï†úÍ≥µÏûêÎ≥ÑÎ°ú ÌïÑÏöîÌïú scopeÏôÄ user-info-uri ÏÑ§Ï†ï
   - CustomOAuth2UserServiceÎ•º ÌÜµÌï¥ ÏÜåÏÖú Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï≤òÎ¶¨

2. **Ïù∏Ï¶ù ÌîÑÎ°úÏÑ∏Ïä§**
   - CustomAuthorizationRequestResolverÎ•º ÌÜµÌïú OAuth2 Ïù∏Ï¶ù ÏöîÏ≤≠ Ï≤òÎ¶¨
   - OAuth2AuthenticationSuccessHandlerÏóêÏÑú Ïù∏Ï¶ù ÏÑ±Í≥µ Ïãú JWT ÌÜ†ÌÅ∞ Î∞úÍ∏â
   - OAuth2AuthenticationFailureHandlerÏóêÏÑú Ïù∏Ï¶ù Ïã§Ìå® Ï≤òÎ¶¨

3. **ÌÜ†ÌÅ∞ Í¥ÄÎ¶¨**
   - JWT Í∏∞Î∞òÏùò Access TokenÍ≥º Refresh Token Íµ¨ÌòÑ
   - RedisÎ•º ÏÇ¨Ïö©Ìïú Refresh Token Ï†ÄÏû• Î∞è Í¥ÄÎ¶¨
   - HttpOnly Ïø†ÌÇ§Î•º ÌÜµÌïú ÏïàÏ†ÑÌïú ÌÜ†ÌÅ∞ Ï†ÑÏÜ°

### Security Íµ¨ÌòÑ Î∞©Ïãù

1. **Î≥¥Ïïà ÏÑ§Ï†ï**
   ```java
   @Configuration
   public class SecurityConfig {
       @Bean
       public SecurityFilterChain securityFilterChain(HttpSecurity http) {
           return http
               .cors(cors -> cors.configurationSource(corsConfigurationSource()))
               .csrf(AbstractHttpConfigurer::disable)
               .formLogin(AbstractHttpConfigurer::disable)
               .sessionManagement(session -> 
                   session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
               .authorizeHttpRequests(authorize -> authorize
                   .requestMatchers("/public/**").permitAll()
                   .requestMatchers("/private/**").authenticated()
                   .anyRequest().denyAll())
               .oauth2Login(oauth2 -> oauth2
                   .authorizationEndpoint(endpoint -> endpoint
                       .authorizationRequestResolver(customAuthorizationRequestResolver))
                   .userInfoEndpoint(userInfo -> userInfo
                       .userService(customOAuth2UserService))
                   .successHandler(oAuth2AuthenticationSuccessHandler)
                   .failureHandler(oAuth2AuthenticationFailureHandler))
               .build();
       }
   }
   ```

2. **Ïù∏Ï¶ù ÌïÑÌÑ∞**
   - LoginAuthFilter: JWT ÌÜ†ÌÅ∞ Í≤ÄÏ¶ù Î∞è Ïù∏Ï¶ù Ï≤òÎ¶¨
   - LogoutAuthFilter: Î°úÍ∑∏ÏïÑÏõÉ Ï≤òÎ¶¨ Î∞è ÌÜ†ÌÅ∞ ÏÇ≠Ï†ú

3. **CORS ÏÑ§Ï†ï**
   ```java
   @Bean
   public CorsConfigurationSource corsConfigurationSource() {
       CorsConfiguration configuration = new CorsConfiguration();
       configuration.setAllowedOrigins(Arrays.asList("*"));
       configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"));
       configuration.setAllowedHeaders(Arrays.asList("*"));
       configuration.setAllowCredentials(true);
       UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
       source.registerCorsConfiguration("/api/**", configuration);
       return source;
   }
   ```

4. **Î≥¥Ïïà Í∞ïÌôî**
   - Stateless ÏÑ∏ÏÖò Í¥ÄÎ¶¨Î°ú ÏÑúÎ≤Ñ Î∂ÄÌïò Í∞êÏÜå
   - CSRF Î≥¥Ìò∏ ÎπÑÌôúÏÑ±Ìôî (REST API Í∏∞Î∞ò)
   - HttpOnly Ïø†ÌÇ§Î•º ÌÜµÌïú XSS Í≥µÍ≤© Î∞©ÏßÄ
   - RedisÎ•º ÏÇ¨Ïö©Ìïú ÌÜ†ÌÅ∞ Í¥ÄÎ¶¨Î°ú Î≥¥ÏïàÏÑ± Í∞ïÌôî

## ‚öôÔ∏è ÌôòÍ≤Ω ÏÑ§Ï†ï

### ÌïÑÏàò ÌôòÍ≤Ω Î≥ÄÏàò

```properties
# OAuth2 Client Credentials
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
KAKAO_CLIENT_ID=your_kakao_client_id
KAKAO_CLIENT_SECRET=your_kakao_client_secret
NAVER_CLIENT_ID=your_naver_client_id
NAVER_CLIENT_SECRET=your_naver_client_secret

# JWT Keys
ACCESS_TOKEN_KEY=your_access_token_key
REFRESH_TOKEN_KEY=your_refresh_token_key

# Database
MYSQL_URL=jdbc:mysql://localhost:3306/oauth2_demo
MYSQL_USER_NAME=your_mysql_username
MYSQL_PASSWORD=your_mysql_password
```

## üèó ÌîÑÎ°úÏ†ùÌä∏ Íµ¨Ï°∞

```
src/main/java/com/example/oauth2demo/
‚îú‚îÄ‚îÄ auth/                 # Ïù∏Ï¶ù Í¥ÄÎ†® ÏΩîÎìú
‚îÇ   ‚îú‚îÄ‚îÄ application/     # Ïù∏Ï¶ù ÏÑúÎπÑÏä§ Î°úÏßÅ
‚îÇ   ‚îú‚îÄ‚îÄ domain/         # ÎèÑÎ©îÏù∏ Î™®Îç∏
‚îÇ   ‚îú‚îÄ‚îÄ dto/            # Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° Í∞ùÏ≤¥
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/ # Ïù∏ÌîÑÎùº Í¥ÄÎ†® ÏΩîÎìú
‚îú‚îÄ‚îÄ common/             # Í≥µÌÜµ ÏÑ§Ï†ï Î∞è Ïú†Ìã∏Î¶¨Ìã∞
‚îú‚îÄ‚îÄ terms/             # ÏïΩÍ¥Ä Í¥ÄÎ†® ÏΩîÎìú
‚îî‚îÄ‚îÄ user/              # ÏÇ¨Ïö©Ïûê Í¥ÄÎ†® ÏΩîÎìú
```

## üîÑ Ïù∏Ï¶ù ÌîÑÎ°úÏÑ∏Ïä§

### 1. ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Í≥ºÏ†ï
1. ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ÏóêÏÑú ÏÜåÏÖú Î°úÍ∑∏Ïù∏ ÏöîÏ≤≠ (`/api/public/oauth2/{provider}`)
2. OAuth2 Ïù∏Ï¶ù ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
3. ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Ï†úÍ≥µÏûêÏóêÏÑú Ïù∏Ï¶ù
4. Ïù∏Ï¶ù ÏÑ±Í≥µ Ïãú ÏΩúÎ∞± URLÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
5. ÏÑúÎ≤ÑÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌöçÎìù Î∞è Ï≤òÎ¶¨
6. JWT ÌÜ†ÌÅ∞ Î∞úÍ∏â Î∞è Ïø†ÌÇ§Ïóê Ï†ÄÏû•
7. Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏

### 2. ÌöåÏõêÍ∞ÄÏûÖ Í≥ºÏ†ï
1. ÏÜåÏÖú Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ ÌõÑ Ïã†Í∑ú ÏÇ¨Ïö©Ïûê ÌôïÏù∏
2. Ïã†Í∑ú ÏÇ¨Ïö©ÏûêÏù∏ Í≤ΩÏö∞ ÏïΩÍ¥Ä ÎèôÏùò ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
3. ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†ÄÏû•
   - ÏÜåÏÖú Í≥ÑÏ†ï Ï†ïÎ≥¥ (Ïù¥Î©îÏùº, ÏÜåÏÖú ID, Ï†úÍ≥µÏûê)
   - ÏÇ¨Ïö©Ïûê Ïó≠Ìï† (ROLE_USER)
4. ÏïΩÍ¥Ä ÎèôÏùò Ï†ïÎ≥¥ Ï†ÄÏû•
5. ÌöåÏõêÍ∞ÄÏûÖ ÏôÑÎ£å ÌõÑ Î©îÏù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏

### 3. Î°úÍ∑∏ÏïÑÏõÉ Í≥ºÏ†ï
1. ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ÏóêÏÑú Î°úÍ∑∏ÏïÑÏõÉ ÏöîÏ≤≠ (`/api/public/logout`)
2. LogoutAuthFilterÏóêÏÑú ÏöîÏ≤≠ Ï≤òÎ¶¨
3. RedisÏóêÏÑú Refresh Token ÏÇ≠Ï†ú
4. Access TokenÍ≥º Refresh Token Ïø†ÌÇ§ ÏÇ≠Ï†ú
   ```java
   Cookie deletedAccessCookie = cookieProvider.generateDeletedAccessTokenCookie();
   Cookie deletedRefreshCookie = cookieProvider.generateDeletedRefreshTokenCookie();
   response.addCookie(deletedAccessCookie);
   response.addCookie(deletedRefreshCookie);
   ```
5. SecurityContext Ï¥àÍ∏∞Ìôî
6. Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏

### 4. ÌÜ†ÌÅ∞ Í∞±Ïã† Í≥ºÏ†ï
1. Access Token ÎßåÎ£å Ïãú (30Î∂Ñ)
2. Refresh TokenÏúºÎ°ú ÏÉàÎ°úÏö¥ Access Token ÏöîÏ≤≠
3. RedisÏóêÏÑú Refresh Token Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù
4. Ïú†Ìö®Ìïú Í≤ΩÏö∞ ÏÉàÎ°úÏö¥ Access Token Î∞úÍ∏â
5. ÏÉàÎ°úÏö¥ Access TokenÏùÑ Ïø†ÌÇ§Ïóê Ï†ÄÏû•
6. Í∏∞Ï°¥ Refresh Token Ïú†ÏßÄ (2Ïùº)

## üîí Î≥¥Ïïà ÏÑ§Ï†ï

- CORS ÏÑ§Ï†ï: API ÏóîÎìúÌè¨Ïù∏Ìä∏Ïóê ÎåÄÌïú ÌÅ¨Î°úÏä§ Ïò§Î¶¨ÏßÑ ÏöîÏ≤≠ ÌóàÏö©
- CSRF Î≥¥Ìò∏: REST API Í∏∞Î∞òÏúºÎ°ú CSRF ÎπÑÌôúÏÑ±Ìôî
- ÏÑ∏ÏÖò Í¥ÄÎ¶¨: Stateless Î∞©Ïãù ÏÇ¨Ïö©
- ÌÜ†ÌÅ∞ Í¥ÄÎ¶¨: HttpOnly Ïø†ÌÇ§ ÏÇ¨Ïö©

## üß™ ÌÖåÏä§Ìä∏

```bash
./gradlew test
```

## üöÄ Ïã§Ìñâ Î∞©Î≤ï

1. ÌôòÍ≤Ω Î≥ÄÏàò ÏÑ§Ï†ï
2. MySQL Î∞è Redis ÏÑúÎ≤Ñ Ïã§Ìñâ
3. Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ïã§Ìñâ:
```bash
./gradlew bootRun
```

## üìù API Î¨∏ÏÑú

- Swagger UI: `http://localhost:8080/api/swagger-ui/index.html`
- OpenAPI Î¨∏ÏÑú: `http://localhost:8080/api/api-docs`

## üîë ÌÜ†ÌÅ∞ ÎßåÎ£å ÏãúÍ∞Ñ

- Access Token: 30Î∂Ñ
- Refresh Token: 2Ïùº
